<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yqwl.dao.BuildingMapper">
	<resultMap id="BaseResultMap" type="com.yqwl.pojo.Building">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		<id column="id" jdbcType="BIGINT" property="id" />
		<result column="mansion_name" jdbcType="VARCHAR" property="mansion_name" />
		<result column="mansion_picture" jdbcType="VARCHAR" property="mansion_picture" />
		<result column="region_sh_id" jdbcType="INTEGER" property="region_sh_id" />
		<result column="region_shname" jdbcType="VARCHAR" property="region_shname" />
		<result column="region_city_id" jdbcType="INTEGER" property="region_city_id" />
		<result column="region_cityname" jdbcType="VARCHAR" property="region_cityname" />
		<result column="region_id" jdbcType="INTEGER" property="region_id" />
		<result column="region_name" jdbcType="VARCHAR" property="region_name" />
		<result column="district" jdbcType="VARCHAR" property="district" />
		<result column="proportion" jdbcType="INTEGER" property="proportion" />
		<result column="floor" jdbcType="INTEGER" property="floor" />
		<result column="traffic_condition" jdbcType="VARCHAR" property="traffic_condition" />
		<result column="activate_time" jdbcType="TIMESTAMP" property="activate_time" />
		<result column="property_fee" jdbcType="DECIMAL" property="property_fee" />
		<result column="parking_fee" jdbcType="DECIMAL" property="parking_fee" />
		<result column="conditioners_fee" jdbcType="DECIMAL" property="conditioners_fee" />
		<result column="intro" jdbcType="VARCHAR" property="intro" />
		<result column="circum" jdbcType="VARCHAR" property="circum" />
		<result column="broker_id" jdbcType="BIGINT" property="broker_id" />
		<result column="longitude" jdbcType="VARCHAR" property="longitude" />
		<result column="latitude" jdbcType="VARCHAR" property="latitude" />
	</resultMap>
	<sql id="Base_Column_List">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		`id`, `mansion_name`, `mansion_picture`, `region_sh_id`,
		`region_shname`, `region_city_id`,
		`region_cityname`, `region_id`, `region_name`, `district`, `proportion`, `floor`,
		`traffic_condition`, `activate_time`, `property_fee`, `parking_fee`,
		`conditioners_fee`,
		`intro`, `circum`, `broker_id`, `longitude`, `latitude`
	</sql>
	<select id="selectByPrimaryKey" parameterType="java.lang.Long"
		resultMap="BaseResultMap">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		select
		<include refid="Base_Column_List" />
		from `t_building`
		where `id` = #{id,jdbcType=BIGINT}
	</select>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		delete from `t_building`
		where `id` = #{id,jdbcType=BIGINT}
	</delete>
	<insert id="insert" parameterType="com.yqwl.pojo.Building">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		<selectKey keyProperty="id" order="AFTER" resultType="java.lang.Long">
			SELECT LAST_INSERT_ID()
		</selectKey>
		insert into `t_building` (`mansion_name`, `mansion_picture`,
		`region_sh_id`,
		`region_shname`, `region_city_id`, `region_cityname`,
		`region_id`, `region_name`, `district`,
		`proportion`, `floor`, `traffic_condition`,
		`activate_time`, `property_fee`, `parking_fee`,
		`conditioners_fee`, `intro`, `circum`,
		`broker_id`, `longitude`, `latitude`
		)
		values (#{mansion_name,jdbcType=VARCHAR},
		#{mansion_picture,jdbcType=VARCHAR}, #{region_sh_id,jdbcType=INTEGER},
		#{region_shname,jdbcType=VARCHAR}, #{region_city_id,jdbcType=INTEGER},
		#{region_cityname,jdbcType=VARCHAR},
		#{region_id,jdbcType=INTEGER}, #{region_name,jdbcType=VARCHAR}, #{district,jdbcType=VARCHAR},
		#{proportion,jdbcType=INTEGER}, #{floor,jdbcType=INTEGER},
		#{traffic_condition,jdbcType=VARCHAR},
		#{activate_time,jdbcType=TIMESTAMP}, #{property_fee,jdbcType=DECIMAL},
		#{parking_fee,jdbcType=DECIMAL},
		#{conditioners_fee,jdbcType=DECIMAL}, #{intro,jdbcType=VARCHAR}, #{circum,jdbcType=VARCHAR},
		#{broker_id,jdbcType=BIGINT}, #{longitude,jdbcType=VARCHAR},
		#{latitude,jdbcType=VARCHAR}
		)
	</insert>
	<insert id="insertSelective" parameterType="com.yqwl.pojo.Building">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		<selectKey keyProperty="id" order="AFTER" resultType="java.lang.Long">
			SELECT LAST_INSERT_ID()
		</selectKey>
		insert into `t_building`
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="mansion_name != null">
				`mansion_name`,
			</if>
			<if test="mansion_picture != null">
				`mansion_picture`,
			</if>
			<if test="region_sh_id != null">
				`region_sh_id`,
			</if>
			<if test="region_shname != null">
				`region_shname`,
			</if>
			<if test="region_city_id != null">
				`region_city_id`,
			</if>
			<if test="region_cityname != null">
				`region_cityname`,
			</if>
			<if test="region_id != null">
				`region_id`,
			</if>
			<if test="region_name != null">
				`region_name`,
			</if>
			<if test="district != null">
				`district`,
			</if>
			<if test="proportion != null">
				`proportion`,
			</if>
			<if test="floor != null">
				`floor`,
			</if>
			<if test="traffic_condition != null">
				`traffic_condition`,
			</if>
			<if test="activate_time != null">
				`activate_time`,
			</if>
			<if test="property_fee != null">
				`property_fee`,
			</if>
			<if test="parking_fee != null">
				`parking_fee`,
			</if>
			<if test="conditioners_fee != null">
				`conditioners_fee`,
			</if>
			<if test="intro != null">
				`intro`,
			</if>
			<if test="circum != null">
				`circum`,
			</if>
			<if test="broker_id != null">
				`broker_id`,
			</if>
			<if test="longitude != null">
				`longitude`,
			</if>
			<if test="latitude != null">
				`latitude`,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="mansion_name != null">
				#{mansion_name,jdbcType=VARCHAR},
			</if>
			<if test="mansion_picture != null">
				#{mansion_picture,jdbcType=VARCHAR},
			</if>
			<if test="region_sh_id != null">
				#{region_sh_id,jdbcType=INTEGER},
			</if>
			<if test="region_shname != null">
				#{region_shname,jdbcType=VARCHAR},
			</if>
			<if test="region_city_id != null">
				#{region_city_id,jdbcType=INTEGER},
			</if>
			<if test="region_cityname != null">
				#{region_cityname,jdbcType=VARCHAR},
			</if>
			<if test="region_id != null">
				#{region_id,jdbcType=INTEGER},
			</if>
			<if test="region_name != null">
				#{region_name,jdbcType=VARCHAR},
			</if>
			<if test="district != null">
				#{district,jdbcType=VARCHAR},
			</if>
			<if test="proportion != null">
				#{proportion,jdbcType=INTEGER},
			</if>
			<if test="floor != null">
				#{floor,jdbcType=INTEGER},
			</if>
			<if test="traffic_condition != null">
				#{traffic_condition,jdbcType=VARCHAR},
			</if>
			<if test="activate_time != null">
				#{activate_time,jdbcType=TIMESTAMP},
			</if>
			<if test="property_fee != null">
				#{property_fee,jdbcType=DECIMAL},
			</if>
			<if test="parking_fee != null">
				#{parking_fee,jdbcType=DECIMAL},
			</if>
			<if test="conditioners_fee != null">
				#{conditioners_fee,jdbcType=DECIMAL},
			</if>
			<if test="intro != null">
				#{intro,jdbcType=VARCHAR},
			</if>
			<if test="circum != null">
				#{circum,jdbcType=VARCHAR},
			</if>
			<if test="broker_id != null">
				#{broker_id,jdbcType=BIGINT},
			</if>
			<if test="longitude != null">
				#{longitude,jdbcType=VARCHAR},
			</if>
			<if test="latitude != null">
				#{latitude,jdbcType=VARCHAR},
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="com.yqwl.pojo.Building">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		update `t_building`
		<set>
			<if test="mansion_name != null">
				`mansion_name` = #{mansion_name,jdbcType=VARCHAR},
			</if>
			<if test="mansion_picture != null">
				`mansion_picture` = #{mansion_picture,jdbcType=VARCHAR},
			</if>
			<if test="region_sh_id != null">
				`region_sh_id` = #{region_sh_id,jdbcType=INTEGER},
			</if>
			<if test="region_shname != null">
				`region_shname` = #{region_shname,jdbcType=VARCHAR},
			</if>
			<if test="region_city_id != null">
				`region_city_id` = #{region_city_id,jdbcType=INTEGER},
			</if>
			<if test="region_cityname != null">
				`region_cityname` = #{region_cityname,jdbcType=VARCHAR},
			</if>
			<if test="region_id != null">
				`region_id` = #{region_id,jdbcType=INTEGER},
			</if>
			<if test="region_name != null">
				`region_name` = #{region_name,jdbcType=VARCHAR},
			</if>
			<if test="district != null">
				`district` = #{district,jdbcType=VARCHAR},
			</if>
			<if test="proportion != null">
				`proportion` = #{proportion,jdbcType=INTEGER},
			</if>
			<if test="floor != null">
				`floor` = #{floor,jdbcType=INTEGER},
			</if>
			<if test="traffic_condition != null">
				`traffic_condition` = #{traffic_condition,jdbcType=VARCHAR},
			</if>
			<if test="activate_time != null">
				`activate_time` = #{activate_time,jdbcType=TIMESTAMP},
			</if>
			<if test="property_fee != null">
				`property_fee` = #{property_fee,jdbcType=DECIMAL},
			</if>
			<if test="parking_fee != null">
				`parking_fee` = #{parking_fee,jdbcType=DECIMAL},
			</if>
			<if test="conditioners_fee != null">
				`conditioners_fee` = #{conditioners_fee,jdbcType=DECIMAL},
			</if>
			<if test="intro != null">
				`intro` = #{intro,jdbcType=VARCHAR},
			</if>
			<if test="circum != null">
				`circum` = #{circum,jdbcType=VARCHAR},
			</if>
			<if test="broker_id != null">
				`broker_id` = #{broker_id,jdbcType=BIGINT},
			</if>
			<if test="longitude != null">
				`longitude` = #{longitude,jdbcType=VARCHAR},
			</if>
			<if test="latitude != null">
				`latitude` = #{latitude,jdbcType=VARCHAR},
			</if>
		</set>
		where `id` = #{id,jdbcType=BIGINT}
	</update>
	<update id="updateByPrimaryKey" parameterType="com.yqwl.pojo.Building">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		update `t_building`
		set `mansion_name` = #{mansion_name,jdbcType=VARCHAR},
		`mansion_picture` = #{mansion_picture,jdbcType=VARCHAR},
		`region_sh_id` = #{region_sh_id,jdbcType=INTEGER},
		`region_shname` = #{region_shname,jdbcType=VARCHAR},
		`region_city_id` = #{region_city_id,jdbcType=INTEGER},
		`region_cityname` = #{region_cityname,jdbcType=VARCHAR},
		`region_id` = #{region_id,jdbcType=INTEGER},
		`region_name` = #{region_name,jdbcType=VARCHAR},
		`district` = #{district,jdbcType=VARCHAR},
		`proportion` = #{proportion,jdbcType=INTEGER},
		`floor` = #{floor,jdbcType=INTEGER},
		`traffic_condition` = #{traffic_condition,jdbcType=VARCHAR},
		`activate_time` = #{activate_time,jdbcType=TIMESTAMP},
		`property_fee` = #{property_fee,jdbcType=DECIMAL},
		`parking_fee` = #{parking_fee,jdbcType=DECIMAL},
		`conditioners_fee` = #{conditioners_fee,jdbcType=DECIMAL},
		`intro` = #{intro,jdbcType=VARCHAR},
		`circum` = #{circum,jdbcType=VARCHAR},
		`broker_id` = #{broker_id,jdbcType=BIGINT},
		`longitude` = #{longitude,jdbcType=VARCHAR},
		`latitude` = #{latitude,jdbcType=VARCHAR}
		where `id` = #{id,jdbcType=BIGINT}
	</update>
	<select id="listBuildingByCondition" resultType="com.yqwl.Vo.BuildingVo">
		SELECT
		b.*
		FROM
		t_building AS b
		JOIN t_houses_new AS h ON b.id = h.building_id
		WHERE
		b.region_city_id = #{cityId}
		AND (ISNULL(#{regionId})
		OR b.region_id = #{regionId})
		AND (
		(ISNULL(#{startSpace})
		OR h.office_space &gt;= #{startSpace})
		AND
		(ISNULL(#{endSpace})
		OR h.office_space &lt;= #{endSpace})
		)
		<if test="startMoney !=null or endMoney != null">
			AND (
			<if test="startMoney != null">
				h.money &gt;= #{startMoney}
			</if>
			<if test="startMoney != null and endMoney != null">
				AND h.money &lt;= #{endMoney}
			</if>
			<if test="endMoney != null and startMoney == null">
				h.money &lt;= #{endMoney}
			</if>
			)
		</if>
		AND (ISNULL(#{fitment}) OR h.fitment = #{fitment})
		AND h.whether = 1
		GROUP BY b.id
	</select>
	<select id="listByBuilding" resultType="com.yqwl.Vo.BuildingVo">
		SELECT
		h.*
		FROM
		t_building AS b
		JOIN t_houses_new AS h ON b.id = h.building_id
		WHERE
		b.region_city_id = #{cityId}
		AND h.whether = 1
		AND (
		ISNULL(#{condition})
		OR b.mansion_name LIKE CONCAT('%', #{condition},
		'%')
		)
		OR (
		ISNULL(#{condition})
		OR b.region_name LIKE CONCAT('%', #{condition},
		'%')
		)
		OR (
		ISNULL(#{condition})
		OR b.district LIKE CONCAT('%', #{condition},
		'%')
		)
	</select>
	<select id="listByHouseCount" resultType="java.lang.Integer">
		SELECT
		COUNT(h.id)
		FROM
		t_building AS b
		JOIN t_houses_new AS h ON b.id = h.building_id
		WHERE
		b.region_city_id = #{cityId}
		AND
		h.whether = 1
	</select>

	<select id="MapSelectBuilding" resultType="com.yqwl.Vo.MapBuildingVo">
		SELECT
		b.id,
		b.mansion_name,
		b.region_name,
		b.longitude,
		b.latitude,
		b.mansion_picture,
		(
		SELECT th.money
		FROM t_houses_new AS th
		WHERE
		th.building_id = b.id
		ORDER BY th.money ASC
		LIMIT 1
		) AS money
		FROM
		t_building AS b
		JOIN t_houses_new AS h ON b.id = h.building_id
		WHERE
		b.region_city_id = #{cityId}
		AND (ISNULL(#{regionId})
		OR b.region_id = #{regionId})
		AND (
		(ISNULL(#{startSpace})
		OR h.office_space &gt;= #{startSpace})
		AND
		(ISNULL(#{endSpace})
		OR h.office_space &lt;= #{endSpace})
		)
		<if test="startMoney !=null or endMoney != null">
			AND (
			<if test="startMoney != null">
				h.money &gt;= #{startMoney}
			</if>
			<if test="startMoney != null and endMoney != null">
				AND h.money &lt;= #{endMoney}
			</if>
			<if test="endMoney != null and startMoney == null">
				h.money &lt;= #{endMoney}
			</if>
			)
		</if>
		AND (ISNULL(#{fitment}) OR h.fitment = #{fitment})
		AND h.whether = 1
		GROUP BY b.id
	</select>

	<select id="selectBuilding" parameterType="com.yqwl.Vo.BuildingListVo"
		resultType="com.yqwl.Vo.BuildingListVo">
		SELECT
		b.id,
		b.mansion_name,
		b.mansion_picture,
		b.region_cityname,
		b.region_name,
		b.region_shname,
		b.district,
		b.proportion,
		b.floor,
		b.traffic_condition,
		b.activate_time,
		b.intro,
		b.circum,
		k.real_name
		FROM
		t_building b,t_broker k
		<where>
		b.broker_id=k.id
		<if test="region_sh_id != null and region_sh_id != ''">
			AND	b.region_sh_id=#{region_sh_id}
		</if>
		<if test="region_city_id != null and region_city_id != ''">
			AND	b.region_city_id=#{region_city_id}
		</if>
		<if test="region_id != null and region_id != ''">
			AND	b.region_id=#{region_id}
		</if>
		<if test="mansion_name != null and mansion_name != ''">
			AND	b.mansion_name LIKE '%${mansion_name}%'
		</if>
		</where> 
		LIMIT #{page},#{limit}
		<!-- b.region_city_id=#{region_city_id} -->
	</select>
	<select id="selectContBuil" resultType="java.lang.Integer"
		parameterType="com.yqwl.Vo.BuildingListVo">
		SELECT
		COUNT(b.id) count
		FROM
		t_building b,t_broker k
		<where>
		b.broker_id=k.id
		<if test="region_sh_id != null and region_sh_id != ''">
			AND	b.region_sh_id=#{region_sh_id}
		</if>
		<if test="region_city_id != null and region_city_id != ''">
			AND	b.region_city_id=#{region_city_id}
		</if>
		<if test="region_id != null and region_id != ''">
			AND	b.region_id=#{region_id}
		</if>
		<if test="mansion_name != null and mansion_name != ''">
			AND	b.mansion_name LIKE '%${mansion_name}%'
		</if>
		</where>
	</select>
	
	<select id="listAllByCityId" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from `t_building`
		WHERE
		`region_city_id` = #{cityId}
	</select>
</mapper>