<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yqwl.dao.SucceedDealMapper">
  <resultMap id="BaseResultMap" type="com.yqwl.pojo.SucceedDeal">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="house_id" jdbcType="BIGINT" property="house_id" />
    <result column="succeed_time" jdbcType="TIMESTAMP" property="succeed_time" />
    <result column="rent_start_time" jdbcType="TIMESTAMP" property="rent_start_time" />
    <result column="rent_end_time" jdbcType="TIMESTAMP" property="rent_end_time" />
    <result column="broker_id" jdbcType="BIGINT" property="broker_id" />
    <result column="pack_no" jdbcType="VARCHAR" property="pack_no" />
    <result column="rental" jdbcType="INTEGER" property="rental" />
    <result column="brokerage" jdbcType="INTEGER" property="brokerage" />
    <result column="land_certificate" jdbcType="VARCHAR" property="land_certificate" />
    <result column="certificate_of_title" jdbcType="VARCHAR" property="certificate_of_title" />
    <result column="supplement" jdbcType="VARCHAR" property="supplement" />
    <result column="party_a_phone" jdbcType="VARCHAR" property="party_a_phone" />
    <result column="party_a_name" jdbcType="VARCHAR" property="party_a_name" />
    <result column="party_a_sex" jdbcType="INTEGER" property="party_a_sex" />
    <result column="party_a_id_number" jdbcType="VARCHAR" property="party_a_id_number" />
    <result column="party_a_address" jdbcType="VARCHAR" property="party_a_address" />
    <result column="party_b_user_id" jdbcType="BIGINT" property="party_b_user_id" />
    <result column="party_b_sex" jdbcType="INTEGER" property="party_b_sex" />
    <result column="party_b_id_number" jdbcType="VARCHAR" property="party_b_id_number" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    `id`, `house_id`, `succeed_time`, `rent_start_time`, `rent_end_time`, `broker_id`, 
    `pack_no`, `rental`, `brokerage`, `land_certificate`, `certificate_of_title`, `supplement`, 
    `party_a_phone`, `party_a_name`, `party_a_sex`, `party_a_id_number`, `party_a_address`, 
    `party_b_user_id`, `party_b_sex`, `party_b_id_number`
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from `t_succeed_deal`
    where `id` = #{id,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from `t_succeed_deal`
    where `id` = #{id,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.yqwl.pojo.SucceedDeal">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Long">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into `t_succeed_deal` (`house_id`, `succeed_time`, `rent_start_time`, 
      `rent_end_time`, `broker_id`, `pack_no`, 
      `rental`, `brokerage`, `land_certificate`, 
      `certificate_of_title`, `supplement`, `party_a_phone`, 
      `party_a_name`, `party_a_sex`, `party_a_id_number`, 
      `party_a_address`, `party_b_user_id`, `party_b_sex`, 
      `party_b_id_number`)
    values (#{house_id,jdbcType=BIGINT}, #{succeed_time,jdbcType=TIMESTAMP}, #{rent_start_time,jdbcType=TIMESTAMP}, 
      #{rent_end_time,jdbcType=TIMESTAMP}, #{broker_id,jdbcType=BIGINT}, #{pack_no,jdbcType=VARCHAR}, 
      #{rental,jdbcType=INTEGER}, #{brokerage,jdbcType=INTEGER}, #{land_certificate,jdbcType=VARCHAR}, 
      #{certificate_of_title,jdbcType=VARCHAR}, #{supplement,jdbcType=VARCHAR}, #{party_a_phone,jdbcType=VARCHAR}, 
      #{party_a_name,jdbcType=VARCHAR}, #{party_a_sex,jdbcType=INTEGER}, #{party_a_id_number,jdbcType=VARCHAR}, 
      #{party_a_address,jdbcType=VARCHAR}, #{party_b_user_id,jdbcType=BIGINT}, #{party_b_sex,jdbcType=INTEGER}, 
      #{party_b_id_number,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.yqwl.pojo.SucceedDeal">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Long">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into `t_succeed_deal`
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="house_id != null">
        `house_id`,
      </if>
      <if test="succeed_time != null">
        `succeed_time`,
      </if>
      <if test="rent_start_time != null">
        `rent_start_time`,
      </if>
      <if test="rent_end_time != null">
        `rent_end_time`,
      </if>
      <if test="broker_id != null">
        `broker_id`,
      </if>
      <if test="pack_no != null">
        `pack_no`,
      </if>
      <if test="rental != null">
        `rental`,
      </if>
      <if test="brokerage != null">
        `brokerage`,
      </if>
      <if test="land_certificate != null">
        `land_certificate`,
      </if>
      <if test="certificate_of_title != null">
        `certificate_of_title`,
      </if>
      <if test="supplement != null">
        `supplement`,
      </if>
      <if test="party_a_phone != null">
        `party_a_phone`,
      </if>
      <if test="party_a_name != null">
        `party_a_name`,
      </if>
      <if test="party_a_sex != null">
        `party_a_sex`,
      </if>
      <if test="party_a_id_number != null">
        `party_a_id_number`,
      </if>
      <if test="party_a_address != null">
        `party_a_address`,
      </if>
      <if test="party_b_user_id != null">
        `party_b_user_id`,
      </if>
      <if test="party_b_sex != null">
        `party_b_sex`,
      </if>
      <if test="party_b_id_number != null">
        `party_b_id_number`,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="house_id != null">
        #{house_id,jdbcType=BIGINT},
      </if>
      <if test="succeed_time != null">
        #{succeed_time,jdbcType=TIMESTAMP},
      </if>
      <if test="rent_start_time != null">
        #{rent_start_time,jdbcType=TIMESTAMP},
      </if>
      <if test="rent_end_time != null">
        #{rent_end_time,jdbcType=TIMESTAMP},
      </if>
      <if test="broker_id != null">
        #{broker_id,jdbcType=BIGINT},
      </if>
      <if test="pack_no != null">
        #{pack_no,jdbcType=VARCHAR},
      </if>
      <if test="rental != null">
        #{rental,jdbcType=INTEGER},
      </if>
      <if test="brokerage != null">
        #{brokerage,jdbcType=INTEGER},
      </if>
      <if test="land_certificate != null">
        #{land_certificate,jdbcType=VARCHAR},
      </if>
      <if test="certificate_of_title != null">
        #{certificate_of_title,jdbcType=VARCHAR},
      </if>
      <if test="supplement != null">
        #{supplement,jdbcType=VARCHAR},
      </if>
      <if test="party_a_phone != null">
        #{party_a_phone,jdbcType=VARCHAR},
      </if>
      <if test="party_a_name != null">
        #{party_a_name,jdbcType=VARCHAR},
      </if>
      <if test="party_a_sex != null">
        #{party_a_sex,jdbcType=INTEGER},
      </if>
      <if test="party_a_id_number != null">
        #{party_a_id_number,jdbcType=VARCHAR},
      </if>
      <if test="party_a_address != null">
        #{party_a_address,jdbcType=VARCHAR},
      </if>
      <if test="party_b_user_id != null">
        #{party_b_user_id,jdbcType=BIGINT},
      </if>
      <if test="party_b_sex != null">
        #{party_b_sex,jdbcType=INTEGER},
      </if>
      <if test="party_b_id_number != null">
        #{party_b_id_number,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.yqwl.pojo.SucceedDeal">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update `t_succeed_deal`
    <set>
      <if test="house_id != null">
        `house_id` = #{house_id,jdbcType=BIGINT},
      </if>
      <if test="succeed_time != null">
        `succeed_time` = #{succeed_time,jdbcType=TIMESTAMP},
      </if>
      <if test="rent_start_time != null">
        `rent_start_time` = #{rent_start_time,jdbcType=TIMESTAMP},
      </if>
      <if test="rent_end_time != null">
        `rent_end_time` = #{rent_end_time,jdbcType=TIMESTAMP},
      </if>
      <if test="broker_id != null">
        `broker_id` = #{broker_id,jdbcType=BIGINT},
      </if>
      <if test="pack_no != null">
        `pack_no` = #{pack_no,jdbcType=VARCHAR},
      </if>
      <if test="rental != null">
        `rental` = #{rental,jdbcType=INTEGER},
      </if>
      <if test="brokerage != null">
        `brokerage` = #{brokerage,jdbcType=INTEGER},
      </if>
      <if test="land_certificate != null">
        `land_certificate` = #{land_certificate,jdbcType=VARCHAR},
      </if>
      <if test="certificate_of_title != null">
        `certificate_of_title` = #{certificate_of_title,jdbcType=VARCHAR},
      </if>
      <if test="supplement != null">
        `supplement` = #{supplement,jdbcType=VARCHAR},
      </if>
      <if test="party_a_phone != null">
        `party_a_phone` = #{party_a_phone,jdbcType=VARCHAR},
      </if>
      <if test="party_a_name != null">
        `party_a_name` = #{party_a_name,jdbcType=VARCHAR},
      </if>
      <if test="party_a_sex != null">
        `party_a_sex` = #{party_a_sex,jdbcType=INTEGER},
      </if>
      <if test="party_a_id_number != null">
        `party_a_id_number` = #{party_a_id_number,jdbcType=VARCHAR},
      </if>
      <if test="party_a_address != null">
        `party_a_address` = #{party_a_address,jdbcType=VARCHAR},
      </if>
      <if test="party_b_user_id != null">
        `party_b_user_id` = #{party_b_user_id,jdbcType=BIGINT},
      </if>
      <if test="party_b_sex != null">
        `party_b_sex` = #{party_b_sex,jdbcType=INTEGER},
      </if>
      <if test="party_b_id_number != null">
        `party_b_id_number` = #{party_b_id_number,jdbcType=VARCHAR},
      </if>
    </set>
    where `id` = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.yqwl.pojo.SucceedDeal">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update `t_succeed_deal`
    set `house_id` = #{house_id,jdbcType=BIGINT},
      `succeed_time` = #{succeed_time,jdbcType=TIMESTAMP},
      `rent_start_time` = #{rent_start_time,jdbcType=TIMESTAMP},
      `rent_end_time` = #{rent_end_time,jdbcType=TIMESTAMP},
      `broker_id` = #{broker_id,jdbcType=BIGINT},
      `pack_no` = #{pack_no,jdbcType=VARCHAR},
      `rental` = #{rental,jdbcType=INTEGER},
      `brokerage` = #{brokerage,jdbcType=INTEGER},
      `land_certificate` = #{land_certificate,jdbcType=VARCHAR},
      `certificate_of_title` = #{certificate_of_title,jdbcType=VARCHAR},
      `supplement` = #{supplement,jdbcType=VARCHAR},
      `party_a_phone` = #{party_a_phone,jdbcType=VARCHAR},
      `party_a_name` = #{party_a_name,jdbcType=VARCHAR},
      `party_a_sex` = #{party_a_sex,jdbcType=INTEGER},
      `party_a_id_number` = #{party_a_id_number,jdbcType=VARCHAR},
      `party_a_address` = #{party_a_address,jdbcType=VARCHAR},
      `party_b_user_id` = #{party_b_user_id,jdbcType=BIGINT},
      `party_b_sex` = #{party_b_sex,jdbcType=INTEGER},
      `party_b_id_number` = #{party_b_id_number,jdbcType=VARCHAR}
    where `id` = #{id,jdbcType=BIGINT}
  </update>
  <select id="listAll" resultType="com.yqwl.Vo.SucceedDealVo">
  	SELECT
		sd.*,
		tb.region_name AS region_name,
		tb.mansion_name AS mansion_name,
		b.real_name
	FROM
		`t_succeed_deal` AS sd,
		t_broker AS b,
		t_group AS g,
		t_shop AS s,
		t_houses_new AS hn,
		t_building AS tb
	WHERE
		sd.broker_id = b.id
	AND b.group_id = g.id
	AND g.shop_id = s.id
	AND sd.house_id = hn.id
	AND hn.building_id = tb.id
	AND (ISNULL(#{shopId}) OR s.id = #{shopId})
	AND (ISNULL(#{groupId}) OR g.id = #{groupId})
	AND (ISNULL(#{brokerId}) OR b.id = #{brokerId})
	AND ((ISNULL(#{startTime}) OR sd.succeed_time <![CDATA[>=]]> #{startTime}) AND (ISNULL(#{endTime}) OR sd.succeed_time <![CDATA[<=]]> #{endTime}))
	AND (ISNULL(#{pack}) OR sd.pack_no LIKE CONCAT("%",#{pack},"%"))
  </select>
  <!-- 添加决策分析(根据条件查询相关经纪人成交单数) -->
  <select id="selectByPrimaryCount" resultType="java.lang.Integer">
		select
		COUNT(1)
		from `t_succeed_deal`
		<where>
			`broker_id` = #{id} 
			<if test="startTime != null and endTime != null">
				AND (`succeed_time` <![CDATA[>=]]>
				#{startTime} AND `succeed_time` <![CDATA[<=]]>
				#{endTime})
			</if>
		</where>
	</select>
	
	<!-- 添加决策分析(根据条件查询相关经纪人成交金额) -->
  <select id="selectByPrimarySum" resultType="java.lang.Integer">
		select
		IFNULL(SUM(brokerage),0)
		from `t_succeed_deal`
		<where>
			`broker_id` = #{id} 
			<if test="startTime != null and endTime != null">
				AND (`succeed_time` <![CDATA[>=]]>
				#{startTime} AND `succeed_time` <![CDATA[<=]]>
				#{endTime})
			</if>
		</where>
	</select>
</mapper>